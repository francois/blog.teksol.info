--- 
title:      "Money library error in substraction"
created_at: 2006-02-13 05:18:00
blog_post:  true
filter:
  - erb
  - textile
--- 
The "Money":http://rubyforge.org/projects/money library is a useful.  Unfortunately, release 1.5.9 has an error.  One cannot substract an amount from the empty Money.

<textarea name="code" cols="55" rows="15" class="ruby">def test_substract_from_zero
  assert_equal -12.to_money, Money.empty - (12.to_money)
end
</textarea>

The test case will fail with this:
<typo:code>  1) Failure:
test_substract_from_zero(MoneyTest) [./test/unit/money_test.rb:29]:
<#<Money:0x3accb68 @cents=-1200, @currency="USD">> expected but was
<#<Money:0x3acca60 @cents=1200, @currency="USD">>.
</textarea>

The error is caused by <code class="method">Money#-(other_money)</code>:

<textarea name="code" cols="55" rows="15" class="ruby">def -(other_money)
  return other_money.dup if cents.zero?
  ...
end
</textarea>

<code class="expression">return other_money.dup if cents.zero?</code> should be removed to allow the test case to pass.

*Update (2006-02-13)*: Tobias already posted a "new version":http://rubyforge.org/frs/?group_id=743&release_id=4262 of the library, available as a gem.
